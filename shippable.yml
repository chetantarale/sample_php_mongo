build_image: chetantarale/u14php7pls:testext1

language: php

php: 
  - "7.0"

services:
  - mongodb
  
before_script: 
  - currentLocation="$PWD"
  - sudo apt-get install php-pear
  - sudo apt-get install libcurl3-openssl-dev
  - sudo pecl install pecl_http
  - sudo su -c /usr/bin/mongod -f /etc/mongod.conf --smallfiles > /dev/null 2>&1 &
  - echo extension=mongodb.so > /etc/php/7.0/mods-available/mongodb.ini
  - echo "extension=mongodb.so" > /etc/php/7.0/fpm/conf.d/20-mongodb.ini
  - echo "extension=mongodb.so" > /etc/php/7.0/cli/conf.d/20-mongodb.ini
  - echo "extension=mongodb.so" > /etc/php/7.0/mods-available/mongodb.ini
  - sudo service php7.0-fpm restart
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - wget https://phar.phpunit.de/phpunit.phar
  - chmod +x phpunit.phar
  - sudo mv phpunit.phar /usr/local/bin/phpunit
  - phpunit --version
  - cd "$currentLocation"

script:
  - phpunit  --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage tests/ConnectToMongoTest.php
  
notifications:
   email: false
